<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>修改个人信息</title>
    <link rel="stylesheet" href="/static/qlsc1.0/public/css/base.css">
    <link rel="stylesheet" href="/static/qlsc1.0/public/css/x1-personalCenter.css">
    <link rel="stylesheet" href="/static/os/topcss/bootstrap.min-1.css" />
    <script src="/static/qlsc1.0/public/js/libraries/jquery-1.12.4.js"></script>
    <script src="/static/qlsc1.0/public/js/libraries/YMDClass.js"></script>
    <script src="/static/qlsc1.0/public/js/x1-personalCenter.js"></script>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        .layui-layer{
            top: 120px!important;
        }
        .f3-column-2{
            display: none;
        }
        .f3-content-search{
            display: none;
        }
    </style>

</head>
<body
        class="page woocommerce-account woocommerce-page woocommerce-edit-account">
<div class="body-wrapper theme-clearfix">

    <div class="y1-personal-container clearFix">
        <!--侧边栏-->
        <div class="y1-personal-column">
            <img id="userPicImg1" src=""  onerror="src='/static/qlsc1.1/public/img/other/head_default.jpg'" class="y1-personal-column-img1" alt=""  width="168px" height="168px">
            <p class="y1-personal-column-p1" id="userName1"></p>
            <ul id="f1-userCenter-left-hover">
                <li class="y1-personal-column-ul-li"
               id="myorder"     data-number="1" >我的订单</li>
                <li class="y1-personal-column-ul-li" data-number="2" >售后管理</li>
                <li class="y1-personal-column-ul-li y1-personal-column-ul-li-active" data-number="3" ><a style="color: #f13a3a">个人资料</a></li>
                <li class="y1-personal-column-ul-li" data-number="5" >收货地址</li>
                <li class="y1-personal-column-ul-li" id="collection" data-number="6">我的收藏</li>
            </ul>
        </div>
        <!-- 右侧内容 -->
        <div class="x1-personalCenter-box">
            <div class="x1-personalCenter-top">
                <p class="x1-personalCenter-title">个人资料</p>
            </div>
            <div class="x1-personalCenter-nav">
                <form id="forms" class="form-horizontal"  data-method="post">
                    <div class="form-group x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left">
                            当前头像 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-headPortrait">
                            <img id="userPicImg" src="" onerror="src='/static/qlsc1.1/public/img/other/head_default.jpg'"  class="x1-personalCenter-headPortrait" />
                            <div class="x1-personalCenter-modification-headPortrait">
                                编辑头像
                            </div>
                            <input type="file" id="imgfile" class="x1-personalCenter-div-tab" name="file" accept="image/*" />
                        </div>
                    </div>
                    <div class="form-group x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            账号 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-hobbies">
                            <input type="text" class="x1-personalCenter-inp1 loginName" value="" readonly="readonly" />
                            <a href="javascript:void(0)" onclick="layer_show('修改密码 ','/uc/user/updatePassWord','500','450')">修改密码</a>
                        </div>
                    </div>
                    <div class="form-group x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            昵称 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-hobbies">
                            <input type="text" class="x1-personalCenter-inp1" id="userName" name="userName" value="" />
                        </div>
                    </div>
                    <div class="form-group  x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            真实姓名 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-hobbies">
                            <input type="text" class="x1-personalCenter-inp2" id="realName" name="realName" value="" />
                        </div>
                    </div>
                    <div class="form-group x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            手机号码 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-hobbies">
                            <input type="text" class="x1-personalCenter-inp1" id="teleNumber" name="telephone" value="" />
                        </div>
                    </div>
                    <div class="form-group x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            邮箱 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-hobbies">
                            <input type="text" class="x1-personalCenter-inp1" id="emailNumber" value="" readonly="readonly"/>
                            <a href="javascript:void(0)" onclick="layer_show('修改邮箱','/uc/user/email','500','500')">修改邮箱</a>
                        </div>
                    </div>
                    <div class="form-group  x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            性别 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-radio">
                            <label class="x1-personalCenter-div-radio-v2">
                                　　<input type="radio" name="sex" id="man" value="1" >
                                　　<span></span>男
                            </label>
                            <label class="x1-personalCenter-div-radio-v2">
                                　　<input type="radio" name="sex" id="woman" value="2">
                                　　<span></span>女
                            </label>
                            <label class="x1-personalCenter-div-radio-v2">
                                　　<input type="radio" name="sex" id="notknow" value="0">
                                　　<span></span>保密
                            </label>
                        </div>
                    </div>
                    <div class="form-group  x1-personalCenter-div clearFix">
                        <div class="x1-personalCenter-div-left1">
                            生日 :&nbsp;
                        </div>
                        <div class="x1-personalCenter-div-birthday">
                            <select name="bothYear"  class="x1-personalCenter-div-birthday-sele"></select><span class="x1-personalCenter-div-birthday-sele-span">年</span>
                            <select name="bothMonth" class="x1-personalCenter-div-birthday-sele"></select><span class="x1-personalCenter-div-birthday-sele-span">月</span>
                            <select name="bothDay" class="x1-personalCenter-div-birthday-sele"></select><span class="x1-personalCenter-div-birthday-sele-span">日</span>
                            <span class="x1-personalCenter-div-birthday-span">填写生日有惊喜哦~</span>
                        </div>
                    </div>

                    <div class="form-group x1-personalCenter-save">
                        <button id="btn_save" class="x1-personalCenter-save-btn">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<a id="etrostore-totop" href="#"></a>
<script type="text/javascript" src="/static/os/topjs/bootstrap.min-1.js"></script>
<link rel="stylesheet" href="/static/common/bootstrap/css/bootstrap.css" />
<!-- bootstrapvalidator-master前端验证框架 -->
<script type="text/javascript" src="/static/common/bootstrapvalidator/js/bootstrapValidator.min.js"></script>
<link rel="stylesheet" href="/static/common/bootstrapvalidator/css/bootstrapValidator.min.css" />
<script type="text/javascript">

   //渲染页面信息

    function  showUserMes() {
        $.ajax({
            url: '/frontEnd/details',
            type: 'get',
            success: function (mes) {
                console.log(mes)

                if ( mes.data.picImg) {
                    $('#userPicImg').attr('src', mes.data.picImg)

                    $('#userPicImg1').attr('src', mes.data.picImg)
                }
                //
                $('.loginName').val(mes.data.loginName);
                // 账号
                $('#userName1').text(mes.data.userName);
                //
                $('#userName').val(mes.data.userName);
                // 昵称
                $('#realName').val(mes.data.realName);
                // 真实姓名
                $('#teleNumber').val(mes.data.telephone);
                // 手机号码
                $('#emailNumber').val(mes.data.email);
                // 邮箱
                function showSex() {
                    if (mes.data.sex === 1) {
                        document.getElementById('man').setAttribute('checked' ,true)
                    } else  if (mes.data.sex === 2 ) {
                        document.getElementById('woman').setAttribute('checked' ,true)
                    } else {
                        document.getElementById('notknow').setAttribute('checked' ,true)
                    }
                }
                showSex()
                // 性别需要判断一下

                // 一个插件 生成生日相关信息
                var _length = $('.x1-personalCenter-div-birthday').size();
                if (_length !== 0 ) {
                    if (!mes.data.bothYear) {
                        new YMDselect('bothYear','bothMonth','bothDay');
                    }else {
                        new YMDselect('bothYear','bothMonth','bothDay', mes.data.bothYear, mes.data.bothMonth, mes.data.bothDay);
                    }
                }



            }
        })
    }
    showUserMes()




    $(function() {


        $('form').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                userName: {
                    message: '昵称验证失败',
                    validators: {
                        notEmpty: {
                            message: '昵称不能为空'

                        }
                    }
                },
                telephone: {
                    message: '手机号码验证失败',
                    validators: {
                        notEmpty: {
                            message: '手机号码不能为空'
                        },
                        regexp: {
                            regexp: /^1[3|5|8|7]{1}[0-9]{9}$/,
                            message: '请输入正确的手机号码'
                        }
                    }
                },
                file: {
                    validators: {
                        file:{
                            extension: 'jpg,jpeg,png',
                            type: 'image/jpeg,image/png',
                            message: '请上传jpg,jpeg,png类型图片'
                        },
                        callback: {
                            message: '图片不能大于100k',
                            callback: function(value, validator) {
                                imgfile =  $('#imgfile').get(0);
                                if (imgfile.files.length>0 && imgfile.files[0].size /1024 > 100) {
                                    layer.msg("图片不能大于100k");
                                    return false;
                                }else{

                                    return true;
                                }
                            }
                        }

                    }
                }

                /* userName: {
                     message: '昵称验证失败',
                     validators: {
                         notEmpty: {
                             message: '昵称不能为空'
                         }
                     }
                 },
                 realName: {
                     message: '真实姓名验证失败',
                     validators: {
                         notEmpty: {
                             message: '真实姓名不能为空'
                         }
                     }
                 },
                 bothYear:{
                     message :'年份验证失败!',
                     validators:{
                         notEmpty:{
                             message:'年份不能为空'
                         },
                         callback: {
                             message: '必须选择一个年份',
                             callback: function(value, validator) {

                                 if (value == 0) {
                                     return false;
                                 } else {
                                     return true;
                                 }

                             }
                         }
                     }
                 },
                 bothMonth:{
                     message :'月份验证失败!',
                     validators:{
                         notEmpty:{
                             message:'月份不能为空'
                         },
                         callback: {
                             message: '必须选择一个月份',
                             callback: function(value, validator) {

                                 if (value == 0) {
                                     return false;
                                 } else {
                                     return true;
                                 }

                             }
                         }
                     }
                 },
                 bothDay:{
                     message :'日期验证失败!',
                     validators:{
                         notEmpty:{
                             message:'日期不能为空'
                         },
                         callback: {
                             message: '必须选择一个日期',
                             callback: function(value, validator) {

                                 if (value == 0) {
                                     return false;
                                 } else {
                                     return true;
                                 }

                             }
                         }
                     }
                 },
                 email: {
                     validators: {
                         notEmpty: {
                             message: '邮箱地址不能为空'
                         },
                         emailAddress: {
                             message: '邮箱地址不正确'
                         }
                     }
                 }*/
            }
        }).on('success.form.bv', function(e) {
            e.preventDefault();
            var $forms = $(e.target);
            var bv = $forms.data('bootstrapValidator');
            var method = $('#forms').attr('data-method');
            var form = document.getElementById("forms");
            var formdata=new FormData(form);
            $("#btn_save").html("保存中...")
            //提交
            $.ajax({
                type:'post',
                data: formdata,
                url:'/uc/user/details',
                processData : false,  //必须false才会避开jQuery对 formdata 的 默认 处理
                contentType : false,  //必须false才会自动加上正确的Content-Type
                success: function(data){
                    console.log(data);
                    if(data.code==1){
                        layer.msg('修改成功', {
                            icon: 1,
                            time: 2000 //2秒关闭（如果不配置，默认是3秒）
                        }, function(){
                            window.location.reload()
                        });
                    }else{
                        layer.msg(data.data, {
                            icon: 2,
                            time: 3000 //2秒关闭（如果不配置，默认是3秒）
                        });
                    }
                }
            })
        });
    })

    /**
     * 弹出层
     * title	标题
     * url		请求的url
     * id		需要操作的数据id
     * w		弹出层宽度（缺省调默认值）
     * h		弹出层高度（缺省调默认值）
     */
    function layer_show(title, url, w, h) {
        if (title == null || title == '') {
            title = false;
        }
        if (w == null || w == '') {
            w = 800;
        }
        if (h == null || h == '') {
            h = ($(window).height() - 50);
        }
        layer.open({
            type : 2,
            area : [ w + 'px', h + 'px' ],
            shadeClose : true,
            shade : false,
            anim : 1, //0-6的动画形式，-1不开启
            //  maxmin : true, //开启最大化最小化按钮
            fix : false, //不固定
            scrollbar : false, //屏蔽游览器滚动条
            title : title,
            content : url
        });
    }
</script>
</body>
</html>
